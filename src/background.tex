\chapter{Literature Review} \label{ch:litrev}

The goal of this thesis work is to optimize the initial radiation transport step of a
coupled, multi-physics process occurring in a system that has moving components.  One
important application of this work is the quantification of the shutdown dose
rate (SDR) during maintenance operations in fusion energy systems (FES).

During the operation of a fusion energy device, the nuclear reactions (e.g. D-T
fusion) occurring in the plasma result in the production of high energy (14 MeV) neutrons
that penetrate deeply into the system components.  Some of the neutron reaction
pathways result in the production of radioisotopes that persist long after
device shutdown.  The activated components emit high energy photons as they
reach stability over time.  These high energy photons
can cause grave health effects, therefore it is necessary to     
quantify the dose rate in order to ensure the safety of personnel working in
fusion facilities.  This is not only important for the time during operation
and immediately after shutdown when the device is in a static configuration,
but also during a maintenance activity 
%when activated components are moving around the facility and 
when the dose rate at a point changes over
time as a function of the position of the activated components.

Performing computational simulations of the radiation transport in these
devices and calculating quantities of interest, such as flux and dose rate, are
a crucial part of the fusion reactor design phase.  These simulations can
inform decisions about the sustainability and safety of the device.  
This chapter will provide background on computational radiation
transport, methods for SDR analysis, methods for optimizing radiation transport
calculations, and finally  how radiation transport calculations are currently
handled in systems with moving geometries and sources.


%\section{Computational Radiation Transport}

%The neutron distribution along with and irradiation and decay scheme of interest 
%can then be input for a nuclear inventory code to generate the photon
%emission density.  This photon emission density is used as a source for the
%photon transport step which ultimately produces the photon flux in every region.
%The photon flux coupled with a flux-to-dose-rate conversion factor will give us
%the dose rate.


%There are two ways to solve the Boltzmann transport equation: deterministically
%and stochastically.
%\cite{haghighat_wagner_2003}.

%\subsection{Deterministic Codes}

% Section about analog MC and the challenges faced when trying to calculate SDR in
% FES with no VR.

\section{Analog Monte Carlo Calculations} \label{sec:analog_mc}
Computational analysis of nuclear systems is most often performed by either
deterministic or stochastic codes.  Deterministic codes discretize the problem
in space, energy, and direction in order to obtain an approximate solution to
the Boltzmann transport equation.  Obtaining high fidelity solutions in every
region of phase space requires increasing the discretization which can
become very memory intensive for large problems. 
The Monte Carlo (MC) method is a stochastic solution to the transport equation \cite{l_m}
that involves the simulation of random particle
walks through phase space.  Achieving high fidelity results with the MC method
does not have the same prohibitively high memory requirements for large,
complex problems; therefore,
%The quantification of the SDR requires a detailed distribution of the
%neutron and photon flux throughout all regions of phase space (space, energy,
%and direction). 
the most optimal way to 
obtain accurate particle distributions in FES is through MC radiation transport.
%rather than deterministic methods.
%\todo{Add paragraph to compare/contrast deterministic and MC}

%To quantify the dose rate, we need to know the flux of photons
%produced by the decaying radionuclides in the activated components. The
%activation is caused by neutron irradiation.
%We need to know what the neutron flux looks like in every region of phase
%space.

%In general, MC calculations rely on repeated random sampling to solve
%mathematical problems.  
When the analog operation mode (i.e. no variance reduction) of MC analysis is 
used to solve radiation transport calculations, 
the source particle's position, energy, direction,
and subsequent collisions are sampled from unbiased probability
distribution functions (PDFs) that describe physical particle behavior.
The particle's journey through space, or history, is tracked until it is
terminated.
Quantities of interest such as flux can be
scored, or tallied, by averaging particle tracks
in discrete regions of phase space.

One challenge incurred by MC simulations of FES is the presence of heavily
shielded regions.  The particles undergo many
collisions (absorption and scattering) in the shielding which results in low
particle fluxes in the attenuated regions.  Regions that have low
particle fluxes are sampled less frequently and therefore have higher
statistical uncertainty than regions with high flux that are sampled very
often.

This uncertainty can be represented by the relative error, $\Re$,
which is defined as the statistical precision, $\sigma_{\overline{x}}$ 
(the standard deviation of the tally scores)
divided by the mean, $\overline{x}$ (the average of the tally scores).
\begin{equation} \label{eq:1.2}
		\Re = \frac{\sigma_{\overline{x}}}{{\overline{x}}}
\end{equation}

For a well behaved, properly converged tally, $\sigma_{\overline{x}}$ is proportional
to $1/\sqrt{N}$ where N is the number
of histories \cite{mcnp_manual}.
%\todo{Should I explain why this is prop. to $1/sqrt{N}$?}
%The relative error is inversely proportional to the number of tally scores.
Therefore, to reduce the uncertainty, one can 
increase the number of particle histories simulated.
%which will in turn increase the amount of computer time. 
Compute time scales linearly with $N$, and
$\Re$ is inversely proportional to $\sqrt{N}$, therefore to reduce the
error by half, the number of histories, and therefore time, required will
quadruple.  

The efficiency of MC calculations is measured by a quantity known as the figure of merit
(FOM).  The FOM is a function of relative error, $\Re$, and computer processing
time, $t_{proc}$.
\begin{equation} \label{eq:1.3}
	FOM = \frac{1}{{{{\Re}^2}t_{proc}}}
\end{equation}
A high FOM is desirable because it means that less computation time is needed to achieve
a reasonably low error ( <0.1 \cite{mcnp_manual}).   

\section{Shutdown Dose Rate Analysis}\label{sec:sdr_calcs}
This section will discuss the two primary workflows used to investigate the SDR:
the Direct 1-Step (D1S) \cite{d1s} and the Rigorous 2-Step (R2S) \cite{r2s}
method.  Both methods couple the neutron and photon transport via activation
analysis to calculate the SDR.

\subsection{D1S}
As its name implies, the D1S method performs coupled neutron-photon transport
in a single simulation.  It relies upon a version of the Monte Carlo N-
Particle (MCNP) transport code \cite{mcnp_manual}, that has slight modifications as well as special 
cross-section data that replaces prompt gammas with decay gammas.
%The nuclear data available in the standard MCNP code includes prompt photon 
%production cross sections, $\sigma_{n,\gamma}$.
When a prompt photon reaction is sampled in a standard MCNP simulation,
the photon is stored until the original neutron transport is
completed. Then, the photon is transported as part of the same simulation.
The version of MCNP5 used by D1S 
%includes a set of modified cross sections that
%approximate the transmutation process.  This 
allows the delayed 
photons to be emitted as if they were prompt so they can be transported in the
same simulation
as the neutrons. A time correction factor calculated with FISPACT \cite{fispact} is later applied.

The Advanced D1S \cite{adv-d1s} includes improvements to allow for the
calculation of dose rate on a 3D mesh.
Because both neutron and photon transport occur in the same simulation,
therefore on the same geometry, D1S
%neither the D1S or Advanced D1S (an improved version with additional features)
is not currently applicable to geometries that undergo movement after shutdown.
This has been identified as a necessary improvement and the development of a
subroutine to produce portable decay photon sources for pure photon
calculations is underway \cite{adv-d1s}. 
%errmmm.. this sounds like TR2S

\subsection{R2S}\label{sec:r2s}
In contrast to D1S, the R2S method relies upon separate MC neutron and photon
transport simulations.  The transport steps are coupled through activation analysis 
by a nuclear inventory code.
The goal of the neutron transport step is to determine the neutron flux
as a function of space and energy.  This neutron flux along with a specific irradiation
and decay scenario are used as input into a nuclear inventory
code to determine the photon emission density as a function of decay time.
The calculated photon emission density for each decay time
is then used as the source for MC photon transport.  A photon flux tally
fitted with flux-to-dose-rate conversion factors is used to
determine the final SDR \cite{r2s}.
Because the neutron and photon transport are performed separately,
different geometries can be used for each transport step which is key for
simulating geometry movement after shutdown.
\subsubsection{Mesh-based R2S}
In order to calculate an accurate dose rate, it is necessary to obtain
detailed distributions of the neutron flux and photon source
throughout the geometry.
The Mesh-tally Coupled R2S (MCR2S) tool was the first implementation of a mesh-based R2S methodology
\cite{mcr2s}.  It couples MCNP neutron and photon transport calculations with
the FISPACT nuclear inventory code. First, multi-group neutron fluxes are
scored on a 3D mesh.
%Because activation codes require the geometry/material
%descriptions in discrete cells or mesh elements, 
Then, the geometry used for MC
transport is discretized onto a mesh, a requirement of activation codes.  Using
the mesh-based geometry/material description,
multi-group neutron fluxes, and an irradiation and decay scenario, the inventory code
calculates the photon emission density in each mesh element for each decay time
\cite{mcr2s}.  These photon emission density distributions are then used as
sources for MC photon transport simulations.  

The Python for Nuclear Engineering (PyNE) tookit has many useful functions and
scripts to assist in nuclear analysis \cite{pyne}. 
PyNE has an R2S module \cite{mesh_r2s} that includes functions and scripts to 
implement the mesh-based R2S method for CAD
geometries.  It relies on the Direct Accelerated Geometry Monte Carlo (DAGMC) toolkit and an MC
code, such as MCNP, for neutron and
photon transport and ALARA \cite{alara} for nuclear inventory analysis.  
The DAGMC toolkit allows MC transport to be performed directly on CAD geometry.

\section{Monte Carlo Variance Reduction Methods}\label{sec:vr_methods}

As mentioned in section \ref{sec:analog_mc}, the presence of highly attenuating
structural materials in 
FES presents a challenge for MC calculations.
Regions with low particle fluxes are not sampled as frequently and therefore
have higher statistical uncertainty associated with results scored there.
A set of techniques, known as variance reduction (VR), can be used to decrease
the statistical uncertainty in these results in a more efficient way than the
brute force method of increasing the number of particle histories.
VR methods aim to increase the FOM, a measure of efficiency given
in Eq. \ref{eq:1.3}, by reducing the compute time 
necessary to achieve a statistically reasonable result.
This is done by modifying particle behavior to preferentially sample trajectories that are likely to
contribute to the tallies of interest.
%This effectively forces more collisions in regions of phase space that are
%important to the tally of interest. 

One way this is accomplished is by sampling from biased PDFs instead of the
standard PDFs used in analog calculations that describe actual particle behavior.
%\todo{Wording: want to clearly make distinction btwn PDFs of actual, physical particle
%behavior and biased PDFs that modify real behavior}
In order to compensate for this biased sampling, the particle statistical weight
is adjusted \cite{cadis}.
%The relationship between the particle statistical weight, $w$, and the PDF that
%governs particle behavior is as follows
\begin{equation} \label{eq:2.1}
		w_{biased} pdf_{biased} = w_{unbiased} pdf_{unbiased}
\end{equation}
If the biased sampling results in an event occurring more frequently than it
does in reality,
the particle weight is decreased and vice verse.  Using biased PDFs 
to preferentially sample events that will result in an increased number of histories that
contribute to the tally of interest 
can decrease the standard deviation, and
therefore relative error, $\Re$, which will increase the FOM.

Another method of VR is particle splitting
and rouletting.  
To increase the number of particle histories that can contribute to a tally of
interest, it is desirable to split particles as they enter more important 
regions and roulette particles as they enter less important regions. 
%When a particle is split into N particles, the weight of each new particle must be reduced 
%according to Eq. \ref{eq:split_weight}
%\begin{equation}\label{eq:split_weight}
%		N*w_{biased} pdf_{biased} = w_{unbiased} pdf_{unbiased}
%\end{equation}
%When a particle instead moves to a region of less importance, it is terminated 
%with a probablity of 1/N.
The decision to split or roulette particles first requires assigning an 
importance, $I$, to every region in the geometry. 
When a particle moves from a region A to a region B,
the ratio of importances is calculated.  If region B is more important than
region A such that 
$I_{B}/I_{A} \geqslant 1$, 
the particle with original weight $w_{0}$ is split into 
$n = I_{B}/I_{A}$
particles, each with weight $w_{0}/n$.  If instead region B is less important
than region A such that
$I_{B}/I_{A} < 1$, 
the particle will undergo roulette. 
The particle will survive with a probability $n$ and weight $w_{0}/n$
\cite{Carter_Cashwell_1975}.
This is particularly useful in calculating results in heavily attenuated
regions, like in FES.  Importances can be assigned in a way that will force
particle flow towards the region of interest.

The weight window method in the Monte Carlo N-Particle (MCNP) code is a flow
control method that utilizes particle
splitting and rouletting.  A weight window is a region of phase-space that is 
assigned an upper and lower bound.  The windows can be assigned to cells in the
geometry, on a superimposed mesh, and to energy bins.  When a particle enters
a weight window, its weight is assessed; if its weight is above the upper bound,
it is split and if it is below the lower bound, it is rouletted.  

The manual generation of weight window bounds requires a priori knowledge of the problem physics and becomes increasingly difficult with the complexity of the geometry. 
Historically, this process has required a considerable amount of time and
effort of a skilled analyst, but there are now various
methods to produce these weight window bounds automatically.
Some of these methods will be discussed in the following section.


\section{Automated Variance Reduction}\label{sec:auto_vr}

%Historically, VR techniques have required a priori knowledge of the problem physics
%in order to assign modified sampling and weight control parameters.
Many techniques have been developed over the years to automate the selection and
assignment of modified sampling and weight control parameters to reduce computational and human effort.

One class of VR techniques, known as hybrid deterministic/MC methods,
takes advantage of the speed of deterministic transport to
estimate a solution to the adjoint Boltzmann transport equation 
which can then be used to generate MC VR parameters.
The adjoint solution has
significance as the measure of importance of a particle to some specified
objective function.  
%\todo{Need to discuss pro/con of deterministic/MC in earlier section}
%Because deterministic solutions to the transport equation %are less precise but
%require much less computation time, they are useful as an estimate of the
%adjoint particle flux throughout phase space.  
%This estimate of adjoint flux
%can then be used to determine the importance of specific regions.
To demonstrate the use of the adjoint solution as an importance function,
first start with the operator form of the linear, time-independent Boltzmann transport
equation \cite{l_m}
\begin{equation} \label{eq:3.1a}
	H\Psi(\overrightarrow{r}, E,\widehat{\Omega})  = q(\overrightarrow{r}, E,\widehat{\Omega})
\end{equation}
where $\Psi$ is the angular flux, q is the source of particles, and the operator H
which describes all particle behavior is given by
\begin{equation} \label{eq:3.1b}
		H = \widehat{\Omega} \cdot \nabla +
		    \sigma_{t}(\overrightarrow{r},E) - 
			\int_{0}^{\infty} dE'
			\int_{4\pi} d\Omega'
			\sigma_{s}( \overrightarrow{r}, E' 
			\rightarrow E, \widehat{\Omega}' 
			\rightarrow \widehat{\Omega} )
\end{equation}
where $\sigma_{t}$ is the total cross-section and $\sigma_{s}$ is the
double-differential scattering cross-section.  The source and angular flux are
functions of six independent variables: a three-dimensional position vector ($\overrightarrow{r}$) 
a two-dimensional directional vector ($\widehat{\Omega}$), and energy (E).
The adjoint identity is stated as
\begin{equation} \label{eq:3.2}
		\langle \Psi^{+} , H\Psi \rangle =
		\langle \Psi, H^{+}\Psi^{+} \rangle
\end{equation}
where $ \langle \cdot \rangle$ refers to the integration over space,
energy, and angle and the adjoint operator $H^{+}$ is given by
\begin{equation} \label{eq:3.2b}
		H^{+} = -\widehat{\Omega} \cdot \nabla +
		    \sigma_{t}(\overrightarrow{r},E) - 
			\int_{0}^{\infty} dE'
			\int_{4\pi} d\Omega'
			\sigma_{s}( \overrightarrow{r}, E 
			\rightarrow E', \widehat{\Omega} 
			\rightarrow \widehat{\Omega}' )
\end{equation}
This identity can be used to form the adjoint transport equation.
\begin{equation} \label{eq:3.3}
		H^{+}\Psi^{+} = q^{+}
\end{equation}

Substituting Eq.\ref{eq:3.1a} and \ref{eq:3.3} into Eq. \ref{eq:3.2}, 
the adjoint identity can also be written as
\begin{equation} \label{eq:3.2b}
		\langle \Psi^{+} , q \rangle =
		\langle \Psi, q^{+} \rangle
\end{equation}

As mentioned, the solution to the adjoint transport
equation will be used as an importance function
therefore the thoughtful selection of an adjoint source $q^{+}$ is needed.

Consider the equation for detector response, R
\begin{equation} \label{eq:3.4}
		R = \langle \Psi, \sigma_{d}\rangle 
\end{equation}
where $\sigma_{d}$ is a detector response function.
If the adjoint source is chosen to be equivalent to the detector response
function,
\begin{equation} \label{eq:3.5}
		q^{+} = \sigma_{d}
\end{equation}
and substituted into Eq. \ref{eq:3.4}  
\begin{equation}\label{eq:resp_adjq}
		R = \langle \Psi, q^{+} \rangle %= \langle \Psi^{+}, q \rangle
\end{equation}
the response has the same form as the right side of Eq. \ref{eq:3.2b}.
Therefore, 
the response can also be written as a function of the adjoint solution
\begin{equation}\label{eq:resp_adjf}
		R = \langle \Psi^{+}, q \rangle
\end{equation}

%the adjoint flux $\Psi^{+}$ represents the importance of a region to R.
%$\sigma_{d}$. /// I think this is wrong and should be R
This final relation allows us to know the response $R$ for any source $q$ once the
adjoint solution $\Psi^{+}$ to a quantity of interest is known.

\subsection{CADIS}
The Consistent Adjoint Driven Importance Sampling (CADIS) method is one of the
hybrid deterministic/MC VR
techniques that uses the adjoint solution as an importance function to 
formulate VR parameters for MC transport \cite{cadis}.
More specifically, CADIS provides a method for generating
a biased source and the weight window lower bounds in a consistent manner.
The consistent generation of biasing parameters
ensures that particles are born within weight windows, eliminating any loss
of efficiency due to particle splitting/rouletting immediately after birth.
Recall that the response, or tally, of interest in a transport calculation can be 
represented in terms of the adjoint flux by Eq. \ref{eq:resp_adjf}.
%the following equation
%\begin{equation} \label{eq:3.6}
%	R = \int_{V}d\overrightarrow{r} \int_{E} dE
%	\int_{4\pi} d\widehat{\Omega}
%	\sigma_{d}(\overrightarrow{r}, E, \widehat{\Omega})
%	\Psi(\overrightarrow{r}, E, \widehat{\Omega})
%\end{equation}
%and in terms of the adjoint flux, 
%\begin{equation} \label{eq:3.7}
%	R = \int_{V}d\overrightarrow{r} \int_{E} dE
%	\int_{4\pi} d\widehat{\Omega}
%	q(\overrightarrow{r}, E, \widehat{\Omega})
%	\Psi^{+}(\overrightarrow{r}, E, \widehat{\Omega})
%\end{equation}
%The MC solution of the response relies upon the sampling of the particle source
%distribution, $q(\overrightarrow{r}, E, \widehat{\Omega})$, represented by a PDF.
To decrease the variance, the CADIS method formulates a biased
source distribution, $\widehat{q}$,  that represents the contribution of particles from phase space
$(\overrightarrow{r}, E, \widehat{\Omega})$ 
to the total detector response, R.
\begin{equation} \label{eq:3.8}
	\widehat{q}(\overrightarrow{r}, E, \widehat{\Omega}) =
	\frac{\Psi^{+}(\overrightarrow{r}, E,\widehat{\Omega})
	q(\overrightarrow{r}, E, \widehat{\Omega})}{R}
\end{equation}
This essentially is a way to bias the sampling of source particles as a function of their 
contribution to the total detector response.
As previously mentioned, when sampling from a biased distribution, the particle weight
needs to be adjusted such that total weight is conserved in order to eliminate systematic bias.  
\begin{equation} \label{eq:3.9}
	w(\overrightarrow{r}, E,
	\widehat{\Omega})\widehat{q}(\overrightarrow{r}, E, \widehat{\Omega})=
	w_{0}q(\overrightarrow{r}, E, \widehat{\Omega})
\end{equation}
Substituting Eq. \ref{eq:3.8} into Eq. \ref{eq:3.9} and setting $w_0$ equal to one, the corrected 
particle weight is given as
\begin{equation} \label{eq:3.10}
	w(\overrightarrow{r}, E, \widehat{\Omega})=
	\frac{R}{\Psi^{+}(\overrightarrow{r}, E, \widehat{\Omega})}
\end{equation}

%The corrected particle weight has an inverse relation to the adjoint flux, or importance function.
%This relationship for the particle statistical weight is used in the source sampling
%and transport process so that source particles are created with weights that reside 
%within their corresponding weight window.
%%The biased transport operator is derived consistently from the biased source
%%parameter.

%In the weight window technique, particles are either split or
%rouletted as they move from region to region based on the ratio of their
%importances and their weight is updated accordingly.  
%This means regions that have a high adjoint flux will have lower weight window lower bounds,
%meaning particles will be split.
%This can be extended to
%the transport biasing parameter which uses the adjoint flux as an importance
%function as follows
%The weights are used for both the source and transport biasing parameters and
%are derived %from importance sampling 
%in a consistent manner.  
%The transport is biased according to the following relationship
%\begin{equation} \label{eq:3.11}
%	w(\overrightarrow{r}, E, \widehat{\Omega})=
%	w(\overrightarrow{r}', E', \widehat{\Omega}')
%	\left [ \frac{\Psi^{+}(\overrightarrow{r}', E', \widehat{\Omega}')}
%	{\Psi^{+}(\overrightarrow{r}, E, \widehat{\Omega})} \right ]
%\end{equation}
%The consistently generated transport biasing parameter, 
The width of the weight windows is determined by a parameter defined to be the
ratio between upper and lower bounds $\alpha =
w_{u}/w_{l}$.  MCNP uses a default value of 5 for $\alpha$.
The equation for weight window lower bounds
is given as 
\begin{equation} \label{eq:3.12}
	w_{l}(\overrightarrow{r}, E, \widehat{\Omega}) = 
	\frac{R}{\Psi^{+}(\overrightarrow{r}, E, \widehat{\Omega})
	(\frac{\alpha + 1}{2})}
\end{equation}

CADIS is ideally suited to reduce the variance of a detector response in a single
target because the source chosen for adjoint transport is the detector response
function corresponding to the detector of interest.  
There are other methods, such as FW-CADIS, that are suited for reducing the variance in 
multiple targets or even globally.

\subsection{FW-CADIS}
The Forward-Weighted (FW)-CADIS method is another hybrid deterministic/MC VR method.
FW-CADIS aims to increase the efficiency of 
detector responses globally or in multiple localized targets \cite{fwcadis}.
The goal is to create uniform particle density in the tally regions thereby
creating uniform statistical uncertainty in the MC results.
This method relies upon a forward deterministic transport solution to
weight the source for adjoint deterministic transport.  The adjoint solution is
then used with the standard CADIS method to produce source and transport
biasing parameters for the forward MC transport simulation.

If the objective is a spatially dependent total response rate, the FW-CADIS 
adjoint source is formulated as
\begin{equation}
	q^{+}(\overrightarrow{r}, E) = \frac{\sigma_d(\overrightarrow{r}, E)}
	{\int_E
	 {\phi(\overrightarrow{r}, E)\sigma_d(\overrightarrow{r}, E)} dE}
\end{equation}
where $\sigma_d(\overrightarrow{r}, E) $ is the response function.
This effectively weights the adjoint source by the inverse of %the  deterministic estimate of
the total forward response
which means that in regions with low forward flux, the adjoint flux, and therefore
importance, will be high and vice verse.  This will result in the overall goal of
nearly equal statistical uncertainty in regions of interest.  
%\todo{mention that the formula for ww is same as cadis}

\section{Automated Variance Reduction for Multi-physics Analysis}\label{sec:auto_vr_sdr}

In its essence, SDR analysis is the analysis of a coupled, multi-physics system;
the initial neutron irradiation is coupled to the decay photon transport
through activation analysis.
As discussed in section \ref{sec:r2s}, the R2S method requires separate MC calculations 
for the neutron and photon transport.  If the MC steps are performed in analog,
applying the R2S workflow to full-scale, 3D FES becomes impractical 
due to the computational effort required
to produce accurate space- and energy-dependent fluxes throughout the geometry.

Optimizing the final step, photon transport in the case of SDR analysis,  
can be done through a straightforward application of the CADIS method to solve 
for the response at a single detector or the FW-CADIS method if the response is desired
in multiple detectors or globally. 
%An adjoint transport calculation can be performed where the detector
%response function is set equal to the photon flux tally fitted with
%flux-to-dose-rate conversion factors
%The resulting adjoint photon flux scored in a region of phase space is equivalent
%to the importance of that region to the detector response.
%and the resulting adjoint flux can be used as an importance function
%Therefore, the adjoint flux can be used to determine source and transport
%biasing parameters.

Optimizing the initial step of a multi-step process, neutron transport in the case of SDR, is not as
straightforward.
%Because the response function depends on the subsequent
%computational steps of activation and decay photon transport \cite{mscadis}.
The Multi-Step CADIS method described in the next section 
provides an explanation for this challenge and a method for solving it.  

\subsection{MS-CADIS}\label{sec:mscadis}
The Multi-Step (MS)-CADIS method of VR was developed to optimize the primary
radiation transport in a coupled, multi-step process.  
%The first implementation of this method 
%was applied to the coupled neutron activation-photon decay process that occurs
%in FES.  Specifically, it
%ITER SDR benchmark experiment \cite{mscadis}.

Optimizing the initial radiation transport
%step of a coupled, multi-step process
relies upon the use of a function that represents the importance of the particles to the
final response of interest, not the response of that individual step \cite{mscadis}.  
This is challenging because the the final response of interest depends on the subsequent 
steps of the multi-step process.

MS-CADIS can be applied to any coupled, multi-step process.  This will be discussed
in more detail in Section \ref{sec:gen_mscadis}.  When it is applied to
SDR calculations, it aims to increase the efficiency of the neutron transport step
using an importance function that captures both the potential of regions to become 
activated and their potential to produce decay photons that contribute to the final SDR \cite{mscadis}.

%As shown before in Eq. *need eqn number*, //don't think this was mentioned
The importance function represents the expected contribution from a particle 
at some point in phase space to the detector response.
%In the theoretical scenario that every source particle contributes the exact 
%expected value, 
The detector response can be
expressed as the inner product of the importance function, $I$, and the source
distribution, $q$.
\begin{equation} \label{eq:4.1}
R = %\int_{V}\int_{E} 
    \langle I(\overrightarrow{r}, E), 
    q(\overrightarrow{r}, E) \rangle
    %dV dE
\end{equation}
MS-CADIS provides a method to calculate an
 approximation 
%\todo{why is this not always an approx?}
of this importance function
where the response is the final response of the multi-step process.  In the case
of an R2S calculation, the final response is the SDR caused by the decay
photons.  The SDR is defined as 
\begin{equation} \label{eq:4.2}
  SDR =  \langle \sigma_{d}(\overrightarrow{r},E_{\gamma}),
  \phi_{\gamma}(\overrightarrow{r}, E_{\gamma}) \rangle
\end{equation}
where $\sigma_{d}$ is the flux-to-dose-rate conversion factor at the position of
the detector and $\phi_{\gamma}$ is photon flux.
%Consider Eq. \ref{eq:resp_adjf} where it was shown that the response, R, is
%equal to the product of the source and adjoint flux.  
%If the adjoint source function is chosen such that the product of the adjoint
%source and the flux is equal to the response, 
%If equation \ref{eq:4.1}
%is taken to have the same form as Eq. \ref{eq:resp_adjf}, and 
Following the CADIS method, the adjoint photon source is chosen to be $\sigma_d$,
so the equation for SDR becomes 
\begin{equation} \label{eq:4.2.1}
	SDR =  \langle q_{\gamma}^{+}(\overrightarrow{r},E_{\gamma}),
                       \phi_{\gamma}(\overrightarrow{r}, E_{\gamma}) \rangle 
\end{equation}
From the adjoint identity, Eq. \ref{eq:3.2b}, the SDR can also be written as 
\begin{equation} \label{eq:4.3}
	SDR =
	\langle q_{\gamma}(\overrightarrow{r},E_{\gamma}),
  \phi_{\gamma}^{+}(\overrightarrow{r}, E_{\gamma}) \rangle 
\end{equation}
which has the same form as Eq. \ref{eq:4.1}.  Therefore, it can be seen that 
the adjoint flux, $\phi_{\gamma}^+$, is an importance function.
%If the adjoint photon
%source is chosen to be $\sigma_d$, the importance function, I,
%is defined as the adjoint solution, $\phi_{\gamma}^{+}$
%leading to the following relationship
%\begin{equation} \label{eq:4.3}
%	SDR =  \langle q_{\gamma}^{+}(\overrightarrow{r},E_{\gamma}),
%  \phi_{\gamma}(\overrightarrow{r}, E_{\gamma}) \rangle 
%	= \langle q_{\gamma}(\overrightarrow{r},E_{\gamma}),
%  \phi_{\gamma}^{+}(\overrightarrow{r}, E_{\gamma}) \rangle 
%\end{equation}

Because the final goal is to formulate a function that represents the importance
of neutrons the final SDR, the
neutron response is set equal to the photon response.
\begin{equation} \label{eq:4.4}
  SDR =  \langle q_{n}^{+}\overrightarrow{r},E_{n}),
  \phi_{n}(\overrightarrow{r}, E_{n}) \rangle 
  = \langle q_{n}\overrightarrow{r},E_{n}),
  \phi_{n}^{+}(\overrightarrow{r}, E_{n}) \rangle 
\end{equation}
It can be seen that the far right side of Eq. \ref{eq:4.4} also has the same 
form as Eq. \ref{eq:4.1} which means that the adjoint neutron flux, $\phi_n^+$, 
serves as an importance function.

Combining equations \ref{eq:4.3} and \ref{eq:4.4}, 
gives the relationship between the neutron and photon responses.
\begin{equation} \label{eq:4.5}
  %SDR =  
	\langle q_{n}^{+}(\overrightarrow{r},E_{n}),
  \phi_{n}(\overrightarrow{r}, E_{n}) \rangle 
%	= \langle q_{n}(\overrightarrow{r},E_{n}),
%  \phi_{n}^{+}(\overrightarrow{r}, E_{n}) \rangle 
  %SDR 
%	=  \langle q_{p}^{+}(\overrightarrow{r},E_{p}),
%  \phi_{p}(\overrightarrow{r}, E_{p}) \rangle 
	= \langle q_{\gamma}(\overrightarrow{r},E_{\gamma}),
  \phi_{\gamma}^{+}(\overrightarrow{r}, E_{\gamma}) \rangle 
\end{equation}

To generate the adjoint neutron flux, 
an adjoint neutron source, $q_n^{+}$, first needs to be formulated.
This requires Eq. \ref{eq:4.5} and another equation
relating the photon source, $q_\gamma$, to the neutron flux, $\phi_n$.
The solution method for the adjoint neutron source, $q_n^+$, will be discussed in the 
next section.
%One can solve for the photon source by performing a full activation analysis,
%but as an approximation,

\subsection{GT-CADIS}
The Groupwise Transmutation (GT)-CADIS method is an implementation of MS-CADIS
solely for SDR analysis.  It provides a solution to the adjoint neutron source, 
$q_n^+$, by calculating a coupling term that relates the neutron flux to the photon 
source \cite{gtcadis}.

Neutron activation is the cause of the photon decay source so the photon 
source at a single point can be
expressed as a non-linear function of $\phi_n$. 
\begin{equation} \label{eq:4.8}
	q_{\gamma}(E_{\gamma}) = \int_{E_n} f(\phi_{n}) dE_{n}
\end{equation}
This function can not be linearized for arbitrary transmutation networks
and irradiation scenarios, but a linear relationship can
be formulated when a set of criteria, known as the Single Neutron Interaction
Low Burnup (SNILB) criteria, are met \cite{gtcadis}.
When met, a solution for the coupling term, 
$T(\overrightarrow{r}, E_{n}, E_{\gamma})$, which approximates the
 transmutation process and is defined by the following equation
\begin{equation} \label{eq:Tdef}
	q_{\gamma}(\overrightarrow{r}, E_{\gamma}) = 
	\int_{E_n}T(\overrightarrow{r}, E_{n}, E_{\gamma})
	\phi_{n}(\overrightarrow{r}, E_{n}) dE_{n}
\end{equation}
can be found.
Eq. \ref{eq:Tdef} can then be substituted into Eq. \ref{eq:4.5} in order to 
solve for the adjoint neutron source as shown below
\begin{equation} \label{eq:gt_adj_nsrc}
	q_{n}^{+}(\overrightarrow{r},E_{n})
	= \int_{E_{\gamma}}T(\overrightarrow{r}, E_{n}, E_{\gamma})
	\phi_{\gamma}^{+}(\overrightarrow{r}, E_{\gamma}) dE_{\gamma}
\end{equation}

To calculate T, a series of single energy group neutron irradiations is 
performed on each material in the geometry.  
%The total number of irradiations performed is the product of the
%number of materials and the number of neutron energy groups.  
The photon sources that are a function of each neutron energy group 
can then be used to calculate T via Eq. \ref{eq:Tdef}.

%GT-CADIS provides an analytical solution to T when the SNILB criteria are met.
It has been shown that for typical FES spectra, materials, and irradiation
scenarios, the SNILB criteria are met \cite{gtcadis}; therefore, GT-CADIS provides a solution
for T, and therefore the adjoint neutron source needed to optimize the neutron
transport for SDR analysis of FES.

%When met, the photon emission density resulting from the irradiation of a
%material with a neutron flux is the sum of contributions from each neutron
%energy group.

\section{Moving Geometries and Sources} \label{sec:moving_sys}
%This section will discuss how systems that involve moving components are
%currently modeled.

\subsection{MCNP6 Moving Objects Capability} \label{sec:mcnp_move}
Historically, MC analysis of moving systems was performed using a 
series of separate simulations with different input files that contained 
step-wise changes of the geometry configuration. 
The new moving object capability that will be available in a future version
of MCNP6 allows for the
motion of objects, sources, and delayed particles during a single simulation
\cite{mcnp_moving_1}, \cite{mcnp_moving_2}.
This capability allows for rigid body transformations of 
objects including rectilinear translations and curvilinear translations and rotations.
The objects can move with constant velocity, constant acceleration, or be
relocated.
Object kinetics are not treated, however, so the user must use caution and supply
transformations that will not cause objects to overlap.
This capability is currently applicable to MCNP's native geometry format,
constructive solid geometry (CSG), and is not available for mesh-based
geometries.

Sources can be assigned to moving objects, therefore can move with the
same dynamics as other objects in the problem.
This capability also allows for the treatment of secondary particles emitted by
objects in motion. This treatment is only approximate because the geometry is fixed during the
transport of source or delayed particles. This is a valid approximation due to
the assumption that the geometry movement is orders of magnitude slower than
particle transport.

During the MCNP simulation, source particles are tracked through the geometry
from the time of emission to termination.  If any of the source particle's
interactions result in the creation of a prompt or delayed secondary particle,
that information is stored.  After the source particle has terminated, any
stored secondary particles are retrieved and transported.
%The geometry is updated to the time a source or delayed particle is created.
In the case of delayed particles emitted from moving objects, the location, direction, energy, and
time are stored at the time of fission or activation and then at the time of
emission, the geometry configuration is updated to provide the correct 
location and orientation of the delayed particle. 

% would not allow for parts of the geometry to be removed or added (e.g. adding
% equipment to move modules around facility, adding shielding, )

% Reference presentation on FLUKA simulation w/ moving geom?

\subsection{MCR2S with Geometry Movement}
The Mesh Coupled implementation of R2S (MCR2S), developed by the Culham Science Center, 
was updated to allow geometry components to change location after shutdown
\cite{mcr2s_move}.
This capability was developed to facilitate SDR calculation during maintenance and
intervention activities.  MCR2S relies on MCNP for both neutron and photon
transport steps and FISPACT for the activation calculations. 
It allows multiple components to be moved to
different locations prior to the photon transport step.

These geometry translations occur by creating a copy of the
components that will move.  Transform cards are applied to the copies. 
The original components remain in their original locations and their material
is changed to vacuum.  Any photon source particle that starts in one of the
components that moves after shutdown is automatically translated to the correct
location. %according to the same transformation.

The requirement that both the original component (set as void) and its
transformed copy are present during the photon transport step means that there
can be no overlap between the parts which could be problematic for small
transformations.

\section{Summary}
%Given the current state of codes that perform MC radiation transport
%simulations and
%the methods of VR to make them more efficient, this work aims to fill in some
%of the gap that exists in tools and methods for the efficient analysis of dynamic, CAD-based
%geometries undergoing coupled, multi-physics processes.  More specifically, 1)
%functionality that updates the position of mesh-based geometries 
%%based on user-supplied motion vectors 
%has been created to allow for MCNP simulations of
%dynamic systems represented by CAD geometry and 2) the GT-CADIS method will be
%updated through the derivation of a time-integrated adjoint
%neutron source that has the ultimate purpose of optimizing the neutron
%transport step in the SDR analysis of a system that moves after shutdown.

The MC method is the most accurate way to obtain detailed distributions of the
neutron and photon fluxes in FES, but it is necessary to use VR methods in
order to efficiently calculate these results.
This section has reviewed some of the most recent work in the fields of VR for SDR analysis 
and MC analysis of moving systems.
GT-CADIS, the implementation of MS-CADIS specifically for SDR analysis has been
proven to effectively optimize the neutron transport step of R2S.
Developments in MCNP6 and MCR2S that provide some capability for updating the
position of geometry have also been discussed.
Given the current state of these fields, this work aims to advance and combine
these efforts through the derivation of a
time-integrated adjoint 
neutron source term that will ultimately optimize the neutron
transport step in systems that undergo movement after shutdown.  
Several computational tools will be developed to support this work. The most
fundamental are the functionality to update the
position of CAD geometries based on time-dependent motion data and aggregate
the transport results calculated at each position over time. 
