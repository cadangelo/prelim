\chapter{Literature Review} \label{ch:litrev}
The goal of this thesis work is to optimize the neutron transport step of a
coupled, multi-physics process occuring in a system that has moving components.  One
important application of this work is the quatification of the SDR during
maintenace operations in FES.
This chapter intends to provide background information on SDR analysis
in FES and how radiation transport calculations are currently handled in systems with
moving geometries and sources.

% Section introducing SDR calculations, particularly for FES
\section{Shutdown Dose Rate Analysis}\label{sec:sdr_calcs}
Shutdown dose rate (SDR) calculations are necessary to quantify the potential
dose to personnel working in facilities exposed to intense radiation fields
such as those present in fusion energy systems (FES).  The dose rate in these
facilities is caused by decay photons that are emitted by materials irradiated
by neutrons. There are two primary workflows used to investigate the SDR:
the Direct 1-Step (D1S) \cite{d1s} and the Rigorous 2-Step (R2S) \cite{r2s} method.

The D1S method performs coupled neutron-gamma transport in the same simulation
It relies upon a modified version of MCNP5 with special cross-section data and
the FISPACT nuclear inventory code for time correction factors.  The decay gammas are emitted as prompt
so they can be transported at the same time as neutrons.  A time correction
factor is later applied.
Because both neutron and photon transport occur in the same simulation,
therefore on the same geometry, D1S
%neither the D1S or Advanced D1S (an improved version with additional features)
is not currently applicable to geometries that undergo movement after shutdown.
This has been identified as a necessary improvement and the development of a
subroutine to produce portable decay photon sources for pure photon
calculations is underway \cite{adv-d1s}. 
%errmmm.. this sounds like TR2S

In constrast to D1S, the R2S method relies upon separate MC neutron and photon
transport steps.  The transport steps are coupled by activation analysis.
The goal of the neutron transport step is to determine the neutron flux
as a function of space and energy.  This neutron flux along with a specific irradiation
and decay scenario are used as input into a nuclear inventory
code to determine the photon spectrum as a function of decay time.
The calculated photon spectrum for each decay time
is then used as the source for the photon transport step.  A photon flux tally
fitted with flux-to-dose-rate conversion factors is used during this step to
determine the final SDR \cite{r2s}.

%\section{Computational Radiation Transport}

%The neutron distribution along with and irradiation and decay scheme of interest 
%can then be input for a nuclear inventory code to generate the photon
%emission density.  This photon emission density is used as a source for the
%photon transport step which ultimately produces the photon flux in every region.
%The photon flux coupled with a flux-to-dose-rate conversion factor will give us
%the dose rate.


%There are two ways to solve the Boltzmann transport equation: deterministically
%and stochastically.
%\cite{haghighat_wagner_2003}.

%\subsection{Deterministic Codes}

% Section about analog MC and the challenges faced when trying to calculate SDR in
% FES with no VR.

\subsection{Analog Monte Carlo Calculations} \label{sec:analog_mc}

The quantification of the SDR requires a detailed distribution of first the
neutron and then the photon flux throughout all regions of phase space.  
Due to the size and complexity of FES, the most optimal way to 
obtain accurate particle distributions is through MC radiation transport 
rather than deterministic methods *need source*.

%To quantify the dose rate, we need to know the flux of photons
%produced by the decaying radionuclides in the activated components. The
%activation is caused by neutron irradiation.
%We need to know what the neutron flux looks like in every region of phase
%space.

In general, MC calculations rely on repeated, random sampling to solve
mathematical problems.  In radiation transport applications, the MC method is 
used to solve the Boltzmann transport equation \cite{l_m} through the simulation of random particle
walks through phase space.  In analog operation mode (i.e. no variance reduction), 
the source particle's position, energy, direction
and subsequent collisions are sampled from probability
distribution functions (PDFs).  Quantities of interest such as flux can be
scored, or tallied, by averaging particle behavior
in discrete regions of phase space.

One challenge incurred by MC simulations of FES is the presence of heavily
shielded regions.  The particles undergo a high degree of
collisions (absorption and scattering) in the shielding which results in low
particle fluxes in these discrete regions of phase space.  Regions that have low
particle fluxes have higher statistical uncertainty.

The statistical error is a function of the relative error, R, which is defined as
\begin{equation} \label{eq:1.2}
		R = \frac{S_{\overline{x}}}{{\overline{x}}}
\end{equation}
where $\overline{x}$ is the average of the tally scores, and $S_{\overline{x}}$ is the standard
deviation of the tally scores.  For a well behaved tally, R is proportional
to $1/\sqrt{N}$ where N is the number of tally scores \cite{mcnp_manual}.

The relative error is inversely proportional to N.
Therefore, to reliably predict results in these regions, many particle
histories need to be simulated which may require large amounts of computer time.


MC calculation efficiency is measured by a quantity known as the figure of merit
(FOM).  The FOM is a function of relative error, R, and computer processing
time, T, 
as given by
\begin{equation} \label{eq:1.3}
		FOM = \frac{1}{{{R^2}T}}
\end{equation}
A high FOM is desirable because it means that less computation time is needed to achieve
a reasonably low error, less than 0.1 according to the MCNP manual \cite{mcnp_manual}. 



\section{Monte Carlo Variance Reduction Methods}\label{sec:vr_methods}

Certain MC calculations require the use of VR methods in order
to complete or improve the efficiency of the calculation. As previously
discussed, the highly-attenuating configuration of FES requires the use of
VR to optimize the transport.
Looking to Eq. \ref{eq:1.3}, VR methods aim to increase the FOM by increasing N and decreasing 
$S_{\overline{x}}$ by by preferentially sampling trajectories that are likely to
contribute to the tallies of interest.
This effectively forces more collisions in regions of phase space that are
important to the tally of interest. 
This is accomplished by sampling from biased PDFs that govern particle behavior. 

In order to compensate for this biased sampling, the particle statistical weight
is adjusted accordingly.
The relationship between the particle statistical weight, w, and the PDF that
governs particle behavior is as follows
\begin{equation} \label{eq:2.1}
		w_{biased} pdf_{biased} = w_{unbiased} pdf_{unbiased}
\end{equation}

One of the earliest and still commonly used methods of VR is particle splitting
and rouletting.  This is particularly useful in deep penetration simulations,
like FES where neutrons penetrate deeply into shielded regions.  
Generally speaking, to increase the number of particle
histories that can contribute to tallies of interest, it is desirable to split
particles as they enter more important regions and roulette particles as the
enter less important regions. 
This requires assigning an importance, $I$, to every
region in the geometry and adjusting the weight, $w$, of the new particles. 
When a particle moves from a region A to a region B,
the ratio of importances is calculated.  If region B is more important than
region A such that 
$I_{B}/I_{A} \geqslant 1$, 
the particle with original weight $w_{0}$ is split into 
$n = I_{B}/I_{A}$
particles, each with weight $w_{0}/n$.  If instead region B is less important
than region A such that
$I_{B}/I_{A} < 1$, 
the particle will undergo roulette. 
The particle will survive with a probability $n$ and weight $w_{0}/n$
\cite{Carter_Cashwell_1975}.
The weight window method in the Monte Carlo N-Particle (MCNP) code utilizes both splitting and
rouletting.  A weight window is a region of phase-space that is assigned an upper and
lower bound.  The windows can be assigned to cells in the geometry, on a
superimposed mesh, and to energy bins.  When a particle enters a weight window, its weight is assessed; if
its weight is above the upper bound or below the lower bound, it is either split
or rouletted, respectively.


\section{Automated Variance Reduction}\label{sec:auto_vr}

Historically, VR techniques have required a priori knowledge of the problem physics
in order to assign importance parameters, therefore requiring a vast amount of
user expertise and time.
Many techniques have been developed over the years to automate the selection and
assignment of these parameters to reduce computational and human effort.

One class of VR techniques, known as hybrid deterministic/MC methods,
is based upon the solution to the adjoint Boltzmann transport equation having
significance as the measure of importance of a particle to some specified
objective function.  
Because deterministic solutions to the transport equation %are less precise but
require much less computation time, they are useful as an estimate of the
adjoint
particle flux throughout phase space which can then be used to determine
importance of specific regions.
To demonstrate the use of the adjoint solution as an importance function,
first start with the linear, time-independent Boltzmann transport
equation shown below
\begin{equation} \label{eq:3.1a}
  H\Psi = q
\end{equation}
where $\Psi$ is the angular flux, q is the source of particles, and the operator H
is given by
\begin{equation} \label{eq:3.1b}
		H = \widehat{\Omega} \cdot \nabla +
		    \sigma_{t}(\overrightarrow{r},E) - 
			\int_{0}^{\infty} dE'
			\int_{4\pi} d\Omega'
			\sigma_{s}( \overrightarrow{r}, E' 
			\rightarrow E, \widehat{\Omega}' 
			\rightarrow \widehat{\Omega} )
\end{equation}
where $\sigma_{t}$ is the total cross-section and $\sigma_{s}$ is the
differential scattering cross-section.
The adjoint identity states that
\begin{equation} \label{eq:3.2}
		\langle \Psi^{+} , H\Psi \rangle =
		\langle \Psi, H^{+}\Psi^{+} \rangle
\end{equation}
where $ \langle \cdot \rangle$ refers to the integration over space,
energy, and angle and the adjoint operator $H^{+}$ is given by
\begin{equation} \label{eq:3.2b}
		H^{+} = -\widehat{\Omega} \cdot \nabla +
		    \sigma_{t}(\overrightarrow{r},E) - 
			\int_{0}^{\infty} dE'
			\int_{4\pi} d\Omega'
			\sigma_{s}( \overrightarrow{r}, E 
			\rightarrow E', \widehat{\Omega} 
			\rightarrow \widehat{\Omega}' )
\end{equation}
This identity can also be written as
\begin{equation} \label{eq:3.2b}
		\langle \Psi^{+} , q \rangle =
		\langle \Psi, q^{+} \rangle
\end{equation}
As mentioned, the adjoint solution to the transport
equation will be used as an importance function therefore a solution to the
following equation is needed
\begin{equation} \label{eq:3.3}
		H^{+}\Psi{+} = q^{+}
\end{equation}
which requires the thoughtful selection of an adjoint source $q^{+}$.
To demonstrate the physical significance of the adjoint, consider the
detector response, R
\begin{equation} \label{eq:3.4}
		R = \langle \Psi, \sigma_{d}\rangle 
\end{equation}
where $\sigma_{d}$ is a detector response function.
If the adjoint source is chosen to be equivalent to the detector response
function,
\begin{equation} \label{eq:3.5}
		q^{+} = \sigma_{d}
\end{equation}
and substituted into Eq. \ref{eq:3.4} and Eq. \ref{eq:3.2b} 
\begin{equation}
		R = \langle \Psi, q^{+} \rangle = \langle \Psi^{+}, q \rangle
\end{equation}
the adjoint flux $\Psi^{+}$ represents the importance of a region to
%$\sigma_{d}$. /// I think this is wrong and should be R
$R$.
This final relation allows us to know the response $R$ for any source $q$ once the
adjoint flux $\Psi^{+}$ for a detector of interest is known.

\subsection{CADIS}
The Consistent Adjoint Driven Importance Sampling (CADIS) method is one of the
hybrid deterministic/MC VR
techniques that uses the adjoint solution to 
formulate source and transport biasing parameters for MC transport.
More specifically, CADIS determines the parameters for source biasing and the
weight window lower bounds in a consistent manner.
The response, or tally, of interest in a transport calculation can be represented by
the following equation
\begin{equation} \label{eq:3.6}
	R = \int_{V}d\overrightarrow{r} \int_{E} dE
	\int_{4\pi} d\widehat{\Omega}
	\sigma_{d}(\overrightarrow{r}, E, \widehat{\Omega})
	\Psi(\overrightarrow{r}, E, \widehat{\Omega})
\end{equation}
and in terms of the adjoint flux, 
\begin{equation} \label{eq:3.7}
	R = \int_{V}d\overrightarrow{r} \int_{E} dE
	\int_{4\pi} d\widehat{\Omega}
	q(\overrightarrow{r}, E, \widehat{\Omega})
	\Psi^{+}(\overrightarrow{r}, E, \widehat{\Omega})
\end{equation}
The MC solution of the response relies upon the sampling of the particle source
distribution, $q(\overrightarrow{r}, E, \widehat{\Omega})$, represented by a PDF.
In an effort to decrease the variance, it is possible to sample from a biased
PDF which is given by
\begin{equation} \label{eq:3.8}
	\widehat{q}(\overrightarrow{r}, E, \widehat{\Omega}) =
	\frac{\Psi^{+}(\overrightarrow{r}, E,\widehat{\Omega})
	q(\overrightarrow{r}, E, \widehat{\Omega})}{R}
\end{equation}
This biased PDF represents the contribution of particles from phase space
%$(\overrightarrow{r}, E, \widehat{\Omega})$ 
to the total detector response, R.
As previously mentioned, when sampling from a biased PDF, the particle weight
needs to be adjusted to eliminate systematic bias.  
\begin{equation} \label{eq:3.9}
	w(\overrightarrow{r}, E,
	\widehat{\Omega})\widehat{q}(\overrightarrow{r}, E, \widehat{\Omega})=
	w_{0}q(\overrightarrow{r}, E, \widehat{\Omega})
\end{equation}
Substituting in Eq. \ref{eq:3.8}, the corrected particle weight is shown to have
an inverse relation to the adjoint flux, or importance function.
\begin{equation} \label{eq:3.10}
	w(\overrightarrow{r}, E, \widehat{\Omega})=
	\frac{R}{\Psi^{+}(\overrightarrow{r}, E, \widehat{\Omega})}
\end{equation}
%The biased transport operator is derived consistently from the biased source
%parameter.
In the weight window technique, particles are either split or
rouletted as they move from region to region based on the ratio of their
importances and their weight is updated accordingly.  
%This can be extended to
%the transport biasing parameter which uses the adjoint flux as an importance
%function as follows
The weights are used for both the source and transport biasing parameters and
are derived %from importance sampling 
in a consistent manner.  
The transport is biased according to the following relationship
\begin{equation} \label{eq:3.11}
	w(\overrightarrow{r}, E, \widehat{\Omega})=
	w(\overrightarrow{r}', E', \widehat{\Omega}')
	\left [ \frac{\Psi^{+}(\overrightarrow{r}', E', \widehat{\Omega}')}
	{\Psi^{+}(\overrightarrow{r}, E, \widehat{\Omega})} \right ]
\end{equation}
The width of the weight windows is determined by a parameter defined to be the
ratio between upper and lower bounds $\alpha =
w_{u}/w_{l}$.  MCNP uses a default value for $\alpha$ and the weight window lower
bounds are given by 
\begin{equation} \label{eq:3.12}
	w_{l}(\overrightarrow{r}, E, \widehat{\Omega}) = 
	\frac{R}{\Psi^{+}(\overrightarrow{r}, E, \widehat{\Omega})
	(\frac{\alpha + 1}{2})}
\end{equation}


\section{Automated Variance Reduction for SDR}\label{sec:auto_vr_sdr}

The R2S method requires two transport steps; 
the initial neutron transport to simulate the irradiation and the subsequent photon
transport simulating the decay photons.  
Applying this method to a full-scale, 3D FES becomes impractical due to the
need for accurate space- and energy-dependent fluxes generated by MC codes 
throughout the geometry.  

Optimizing the photon transport step can be done through a
straightforward application of the CADIS %or FW-CADIS
method *need source*. 
An adjoint transport calculation can be performed where the detector
response function is set equal to the photon flux tally fitted with
flux-to-dose-rate conversion factors
The resulting adjoint photon flux scored in a region of phase space is equivalent
to the importance of that region to the detector response.
%and the resulting adjoint flux can be used as an importance function
Therefore, the adjoint flux can be used to determine source and transport
biasing parameters.

Optimizing the neutron transport step of R2S, however, is not as
straightforward
%Because the response function depends on the subsequent
%computational steps of activation and decay photon transport \cite{Ibrahim_2015}.
because the importance function needs to represent the importance of the neutrons to the
final quantity of interest\cite{Ibrahim_2015}.
When applied to SDR calculations, the Multi-Step Consistent Adjoint Driven Importance Sampling (MS-CADIS) method
aims to increase the efficiency of the neutron transport step using an importance function
that captures the potential of regions to become activated and the importance of
the resulting decay photons to the final SDR\cite{Ibrahim_2015}.

%As shown before in Eq. *need eqn number*, //don't think this was mentioned
The detector response can be
expressed as the integral of the importance function, $I$, multiplied by the source
distribution, $q$
\begin{equation} \label{eq:4.1}
R = \int_{V}\int_{E} 
    I(\overrightarrow{r}, E)
    q(\overrightarrow{r}, E)
    dV dE
\end{equation}
MS-CADIS provides a method to calculate an approximation of this importance function
where the response is the final response of the multi-step process.  In the case
of an R2S calculation, the final response is the SDR caused by the decay
photons.  The SDR is defined as 
\begin{equation} \label{eq:4.2}
  SDR =  \langle \sigma_{d}(\overrightarrow{r},E_{p}),
  \phi_{p}(\overrightarrow{r}, E_{p}) \rangle
\end{equation}
where $\sigma_{d}$ is the flux-to-dose-rate conversion factor at the position of
the detector and $\phi_{p}$ is photon flux.
Consider Eq. \ref{eq:3.4} where it was shown that the response R is
equal to the product of the flux and adjoint source.  
%If the adjoint source function is chosen such that the product of the adjoint
%source and the flux is equal to the response, 
If equation \ref{eq:4.1}
is taken to have the same form as Eq. \ref{eq:4.2}, and the adjoint photon
source is set equal to $\sigma_d$, the importance function, I,
is defined as the solution of the adjoint transport equation, $\phi_{p}^{+}$
leading to the following relationship
\begin{equation} \label{eq:4.3}
	SDR =  \langle q_{p}^{+}(\overrightarrow{r},E_{p}),
  \phi_{p}(\overrightarrow{r}, E_{p}) \rangle 
	= \langle q_{p}(\overrightarrow{r},E_{p}),
  \phi_{p}^{+}(\overrightarrow{r}, E_{p}) \rangle 
\end{equation}
The goal of MS-CADIS is to develop an importance function that represents the
importance of the neutrons to the final SDR, which is done by setting the
neutron adjoint identity equal to the photon response in a relationship
equivalent to that shown in \ref{eq:4.3}
\begin{equation} \label{eq:4.4}
  SDR =  \langle q_{n}^{+}\overrightarrow{r},E_{n}),
  \phi_{n}(\overrightarrow{r}, E_{n}) \rangle 
  = \langle q_{n}\overrightarrow{r},E_{n}),
  \phi_{n}^{+}(\overrightarrow{r}, E_{n}) \rangle 
\end{equation}
Combining these adjoint identities in Eq. \ref{eq:4.3} and \ref{eq:4.4}, 
gives a relationship
\begin{equation} \label{eq:4.5}
  %SDR =  
	\langle q_{n}^{+}(\overrightarrow{r},E_{n}),
  \phi_{n}(\overrightarrow{r}, E_{n}) \rangle 
%	= \langle q_{n}(\overrightarrow{r},E_{n}),
%  \phi_{n}^{+}(\overrightarrow{r}, E_{n}) \rangle 
  %SDR 
%	=  \langle q_{p}^{+}(\overrightarrow{r},E_{p}),
%  \phi_{p}(\overrightarrow{r}, E_{p}) \rangle 
	= \langle q_{p}(\overrightarrow{r},E_{p}),
  \phi_{p}^{+}(\overrightarrow{r}, E_{p}) \rangle 
\end{equation}

In order to solve for the adjoint neutron source, $q_n^{+}$, an equation
relating the photon source, $q_p$, to the neutron flux, $\phi_n$, is needed.
%One can solve for the photon source by performing a full activation analysis,
%but as an approximation,

The Groupwise-Transmutation (GT)-CADIS method, an implementation of MS-CADIS
solely for SDR analysis, provides a means to do just that \cite{gtcadis}.

The decay photon source is a result of neutron irradiation and 
the two quantities can be related by the following
definition:
\begin{equation} \label{eq:4.6}
	q_p(\overrightarrow{r}, E_{p}) = 
	\int_{E_n}T(\overrightarrow{r}, E_{n}, E_{p})
	\phi_{n}(\overrightarrow{r}, E_{n}) dE_{n}
\end{equation}
where $T(\overrightarrow{r}, E_{n}, E_{p})$ is a quantity that represents the
transmutation process.  If an adequate T can be found, this photon source can
be used to solve for the adjoint neutron source in Eq. \ref{eq:4.5}.
\begin{equation} \label{eq:4.7}
        q_{n}^{+}\overrightarrow{r},E_{n})
        = \int_{E_p}T(\overrightarrow{r}, E_{n}, E_{p})
	\phi_{p}^{+}(\overrightarrow{r}, E_{p}) dE_{p}
\end{equation}
Concentrating on the photon source at a single point, Eq. \ref{eq:4.6} can be
expressed as this non-linear function of $\phi_n$ 
\begin{equation} \label{eq:4.8}
	q_{p}(E_{p}) = \int_{E_n} f(\phi_{n}) dE_{n}
\end{equation}
The full transmutation process is complex and would be
tedious to capture.  As the purpose of calculating T is only a step in
calculating $q_{n}^{+}$ which will be used to generate our biasing parameters,
an approximation of a linear relationship between $q_p$ and $\phi_n$ will suffice.  


\section{Moving Systems} \label{sec:moving_sys}
%This section will discuss how systems that involve moving components are
%currently modeled.
Historically, Monte Carlo analysis of dynamic systems is performed using a series of separate
simulations with different input files that contain step-wise changes of the
geometry configuration. 
A new capability that will be available in a future version of MCNP6 allows for the
motion of objects, sources, and delayed particles during a single simulation
\cite{mcnp_moving_1}, \cite{mcnp_moving_2}.
The Mesh Coupled implementation of the R2S methon (MCR2S) \cite{mcr2s}
developed by the Culham Science Center was updated to allow for geometry
components to change location after shutdown.

\subsection{MCNP6 Moving Objects Capability} \label{sec:mcnp_move}
The moving objects capability in MCNP6 allows for rigid body transformations of 
objects including rectilinear translations and curvilinear translations and rotations.
The objects can move with constant velocity, constant acceleration, or be
relocated.
Object kinetics are not treated so the user must use caution and supply
transformations that will not cause objects to overlap.
This capability is currently applicable to MCNP's native geometry format,
constructive solid geometry (CSG) and is not available for mesh-based
geometries.

Sources can be assigned to moving objects, therefore can move with the
same dynamics as other objects in the problem.
This capability also allows for the treatment of secondary particles emitted by
objects in motion. This treatment is only approximate because the geometry is fixed during the
transport of source or delayed particles. This is a valid approximation due to
the assumption that the geometry movement is orders of magnitude slower than
particle transport.
During the MCNP simulation, source particles are tracked through the geometry
from the time of emission to termination.  If any of the source particle's
interactions result in the creation of a prompt or delayed secondary particle,
that information is stored.  After the source particle has terminated, any
stored secondary particles are retrieved and transported.
%The geometry is updated to the time a source or delayed particle is created.
In the case of delayed particles emitted from moving objects, the location, direction, energy, and
time are stored at the time of fission or activation and then at the time of
emission, the geometry configuration is updated to provide the correct 
location and orientation of the delayed particle at the time of emission. 

% would not allow for parts of the geometry to be removed or added (e.g. adding
% equipment to move modules around facility, adding shielding, )

% Reference presentation on FLUKA simulation w/ moving geom?

\subsection{MCR2S Geometry Movement in SDR Analysis}
The capability of MCR2S that allows for components to change location after
shutdown was developed to facilitate SDR calculation during maintenance and
intervention activities.  MCR2S relies on MCNP for both neutron and photon
transport steps and FISPACT for the activation calculations. 
It allows multiple components to be moved to
different locations prior to the photon transport step.
These geometry translations occur by creating a copy of the
components that will move.  Transform cards are applied to the copies. 
The original components remain in their original locations and their material
is changed to vacuum.  Any source particle that starts in one of the
components that moves after shutdown is automatically translated to the correct
location according to the same transformation.
The requirement that both the original component (set as void) and its
transformed copy are present during the photon transport step means that there
can be no overlap between the parts which could be problematic for small
transformations.

